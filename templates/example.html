{% extends 'base.html' %}

{% block content %}
<h2>Example Page - Demo Passwords</h2>

<div class="table-container">
  <table class="table">
    <thead>
      <tr>
        <th>Site</th>
        <th>Username</th>
        <th>Password</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for entry, password in data %}
      <tr>
        <td><strong>{{ entry.site }}</strong></td>
        <td>{{ entry.username }}</td>
        <td>
          <div class="password-input-wrapper">
            <input type="password" class="form-control password-field" value="{{ password }}" readonly>
            <button type="button" class="btn-icon-inline toggle-btn" title="Show/Hide password">
              <svg class="icon-show" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <svg class="icon-hide" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </button>
            <button type="button" class="btn-icon-inline copy-btn" data-password="{{ password }}" title="Copy password">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </div>
        </td>
        <td>
          <a href="#" class="delete-btn" data-entry-id="{{ entry.id }}" data-site="{{ entry.site }}">üóëÔ∏è Delete</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div style="text-align: center; margin-top: 2rem;">
  <p style="color: var(--text-light); margin-bottom: 1rem;">This is example data to demonstrate the password manager. Deletions are temporary (session only).</p>
  <a href="{{ url_for('register') }}" class="btn btn-primary">Create Your Account</a>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h3>Delete Password (Demo)</h3>
    <p id="deleteMessage">Are you sure you want to delete this password?</p>
    <p style="font-size: 0.85rem; color: var(--text-light);">This will only delete it for your current session.</p>
    <div class="modal-buttons">
      <button id="cancelDelete" class="btn btn-outline-secondary">Cancel</button>
      <button id="confirmDelete" class="btn btn-danger">Delete</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast">
  ‚úì Copied to clipboard!
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleButtons = document.querySelectorAll('.toggle-btn');

    toggleButtons.forEach(function (btn) {
      btn.addEventListener('click', function () {
        const passwordInput = this.closest('tr').querySelector('.password-field');
        const iconShow = this.querySelector('.icon-show');
        const iconHide = this.querySelector('.icon-hide');

        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          iconShow.style.display = 'none';
          iconHide.style.display = 'block';
        } else {
          passwordInput.type = 'password';
          iconShow.style.display = 'block';
          iconHide.style.display = 'none';
        }
      });
    });

    // Copy to clipboard functionality
    const copyButtons = document.querySelectorAll('.copy-btn');
    const toast = document.getElementById('toast');

    copyButtons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        const password = this.getAttribute('data-password');

        // Copy to clipboard
        navigator.clipboard.writeText(password).then(function() {
          // Show toast notification
          toast.classList.add('show');

          // Hide toast after 2 seconds
          setTimeout(function() {
            toast.classList.remove('show');
          }, 2000);
        }).catch(function(err) {
          console.error('Failed to copy:', err);
        });
      });
    });

    // Delete confirmation modal
    const modal = document.getElementById('deleteModal');
    const deleteMessage = document.getElementById('deleteMessage');
    const confirmBtn = document.getElementById('confirmDelete');
    const cancelBtn = document.getElementById('cancelDelete');
    let deleteUrl = '';

    document.querySelectorAll('.delete-btn').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const entryId = this.getAttribute('data-entry-id');
        const site = this.getAttribute('data-site');
        deleteUrl = "{{ url_for('delete_example', entry_id=0) }}".replace('0', entryId);
        deleteMessage.textContent = `Are you sure you want to delete the password for ${site}?`;
        modal.style.display = 'flex';
      });
    });

    confirmBtn.addEventListener('click', function() {
      window.location.href = deleteUrl;
    });

    cancelBtn.addEventListener('click', function() {
      modal.style.display = 'none';
    });

    // Close modal when clicking outside
    window.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
</script>
{% endblock %}