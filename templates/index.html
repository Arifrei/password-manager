{% extends 'base.html' %}

{% block content %}
<!-- Header with title and controls -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; gap: 1rem; flex-wrap: wrap;">
  <h1 style="margin: 0;">Password Manager</h1>

  <div style="display: flex; gap: 1rem; align-items: center; justify-content: flex-end; flex-wrap: wrap;">
    <!-- Search Bar -->
    <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 0.75rem 1rem; width: 280px; max-width: 280px; min-width: 200px;">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" id="searchInput" placeholder="Search passwords..."
               style="flex: 1; border: none; outline: none; font-size: 0.95rem; padding: 0; background: transparent;">
        <span id="searchCount" style="color: #6b7280; font-size: 0.85rem; white-space: nowrap;"></span>
        <button id="clearSearch" style="display: none; background: none; border: none; cursor: pointer; color: #6b7280; padding: 0.25rem;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <!-- Export Dropdown -->
    <div style="position: relative;">
      <button id="exportBtn" class="btn btn-outline-secondary" style="white-space: nowrap; display: flex; align-items: center; gap: 0.5rem;">
        Export
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </button>
      <div id="exportDropdown" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 160px; z-index: 1000; overflow: hidden;">
        <a href="{{ url_for('export_csv') }}" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; color: #374151; text-decoration: none; border-bottom: 1px solid #f3f4f6; transition: background 0.2s;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="12" y1="18" x2="12" y2="12"></line>
            <line x1="9" y1="15" x2="15" y2="15"></line>
          </svg>
          <span style="font-weight: 500;">CSV Format</span>
        </a>
        <a href="{{ url_for('export_json') }}" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; color: #374151; text-decoration: none; transition: background 0.2s;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <path d="M10 12h4"></path>
            <path d="M10 16h4"></path>
          </svg>
          <span style="font-weight: 500;">JSON Format</span>
        </a>
      </div>
    </div>

    <!-- Add Password Button -->
    <a href="{{ url_for('add_password') }}" class="btn btn-primary" style="white-space: nowrap;">‚ûï Add Password</a>
  </div>
</div>

<div class="table-container">
  <!-- Bulk Actions Bar (hidden by default) -->
  <div id="bulkActionsBar" style="display: none; background: #667eea; color: white; padding: 1rem; border-radius: 12px 12px 0 0; margin-bottom: -1px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span id="selectedCount" style="font-weight: 600;">0 selected</span>
      <div style="display: flex; gap: 1rem;">
        <button id="bulkDeleteBtn" class="btn btn-danger" style="background: #f87171; border: none;">
          üóëÔ∏è Delete Selected
        </button>
        <button id="deselectAllBtn" style="background: rgba(255,255,255,0.2); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; font-weight: 500;">
          Clear Selection
        </button>
      </div>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th style="width: 50px;">
          <input type="checkbox" id="selectAll" style="cursor: pointer; width: 18px; height: 18px;">
        </th>
        <th>Site</th>
        <th>Username</th>
        <th>Password</th>
        <th>Additional Fields</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for entry, username, password, additional_fields in data %}
      <tr data-entry-id="{{ entry.id }}">
        <td>
          <input type="checkbox" class="row-checkbox" data-entry-id="{{ entry.id }}" data-site="{{ entry.site }}" style="cursor: pointer; width: 18px; height: 18px;">
        </td>
        <td><strong>{{ entry.site }}</strong></td>
        <td>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <span style="flex: 1;">{{ username }}</span>
            <button type="button" class="copy-btn" data-copy="{{ username }}" data-type="username" title="Copy username"
                    style="position: relative; background: none; border: none; padding: 0.4rem; cursor: pointer; color: #667eea; border-radius: 4px; transition: all 0.2s;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </div>
        </td>
        <td>
          <div class="password-input-wrapper">
            <input type="password" class="form-control password-field" value="{{ password }}" readonly>
            <button type="button" class="btn-icon-inline toggle-btn" title="Show/Hide password">
              <svg class="icon-show" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <svg class="icon-hide" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </button>
            <button type="button" class="btn-icon-inline copy-btn" data-copy="{{ password }}" data-type="password" title="Copy password">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </div>
        </td>
        <td>
          {% if additional_fields %}
            <button type="button" class="view-fields-btn" data-entry-id="{{ entry.id }}" style="display: inline-flex; align-items: center; gap: 0.3rem; background: #667eea; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <span>View {{ additional_fields|length }} field{{ 's' if additional_fields|length != 1 else '' }}</span>
            </button>
            <!-- Hidden fields container -->
            <div id="fields-{{ entry.id }}" class="fields-container" style="display: none; margin-top: 0.75rem;">
              {% for field in additional_fields %}
                <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.6rem 0.8rem; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.5rem;">
                  <div style="flex: 1;">
                    <div style="font-weight: 600; color: #667eea; font-size: 0.85rem; margin-bottom: 0.25rem;">{{ field.label }}</div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                      <input type="password" class="field-value-display" value="{{ field.value }}" readonly style="flex: 1; border: none; background: transparent; font-family: monospace; font-size: 0.9rem; padding: 0.25rem 0;">
                      <button type="button" class="toggle-field-btn" title="Show/Hide" style="background: none; border: none; cursor: pointer; padding: 0.25rem; color: #6b7280;">
                        <svg class="icon-show-field" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                          <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <svg class="icon-hide-field" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                          <line x1="1" y1="1" x2="23" y2="23"></line>
                        </svg>
                      </button>
                      <button type="button" class="copy-btn" data-copy="{{ field.value }}" data-type="field" data-field-name="{{ field.label }}" title="Copy {{ field.label }}" style="background: none; border: none; cursor: pointer; padding: 0.25rem; color: #667eea;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <span style="color: #9ca3af; font-size: 0.9rem; font-style: italic;">None</span>
          {% endif %}
        </td>
        <td>
          <div style="display: flex; gap: 0.5rem; justify-content: center; align-items: center;">
            <a href="{{ url_for('edit_password', entry_id=entry.id) }}" class="btn btn-sm btn-outline-secondary" title="Edit password" style="display: inline-flex; align-items: center; gap: 0.25rem;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
              Edit
            </a>
            <a href="#" class="delete-btn" data-entry-id="{{ entry.id }}" data-site="{{ entry.site }}" style="color: var(--danger-color); text-decoration: none; font-weight: 600; padding: 0.4rem 0.8rem; border-radius: 8px; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.25rem;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Delete
            </a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h3>Delete Password</h3>
    <p id="deleteMessage">Are you sure you want to delete this password?</p>
    <div class="modal-buttons">
      <button id="cancelDelete" class="btn btn-outline-secondary">Cancel</button>
      <button id="confirmDelete" class="btn btn-danger">Delete</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Toggle password visibility
    const toggleButtons = document.querySelectorAll('.toggle-btn');

    toggleButtons.forEach(function (btn) {
      btn.addEventListener('click', function () {
        const passwordInput = this.closest('tr').querySelector('.password-field');
        const iconShow = this.querySelector('.icon-show');
        const iconHide = this.querySelector('.icon-hide');

        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          iconShow.style.display = 'none';
          iconHide.style.display = 'block';
        } else {
          passwordInput.type = 'password';
          iconShow.style.display = 'block';
          iconHide.style.display = 'none';
        }
      });
    });

    // Toggle additional fields visibility (show/hide fields container)
    const viewFieldsButtons = document.querySelectorAll('.view-fields-btn');

    viewFieldsButtons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        const entryId = this.getAttribute('data-entry-id');
        const fieldsContainer = document.getElementById('fields-' + entryId);
        const buttonText = this.querySelector('span');

        if (fieldsContainer.style.display === 'none') {
          fieldsContainer.style.display = 'block';
          buttonText.textContent = 'Hide fields';
        } else {
          fieldsContainer.style.display = 'none';
          const fieldCount = fieldsContainer.querySelectorAll('.field-value-display').length;
          buttonText.textContent = 'View ' + fieldCount + ' field' + (fieldCount !== 1 ? 's' : '');
        }
      });
    });

    // Toggle individual field value visibility (show/hide like passwords)
    const toggleFieldButtons = document.querySelectorAll('.toggle-field-btn');

    toggleFieldButtons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        const fieldInput = this.closest('div').querySelector('.field-value-display');
        const iconShow = this.querySelector('.icon-show-field');
        const iconHide = this.querySelector('.icon-hide-field');

        if (fieldInput.type === 'password') {
          fieldInput.type = 'text';
          iconShow.style.display = 'none';
          iconHide.style.display = 'block';
        } else {
          fieldInput.type = 'password';
          iconShow.style.display = 'block';
          iconHide.style.display = 'none';
        }
      });
    });

    // Copy to clipboard functionality with custom messages
    const copyButtons = document.querySelectorAll('.copy-btn');
    const toast = document.getElementById('toast');

    copyButtons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        const textToCopy = this.getAttribute('data-copy');
        const copyType = this.getAttribute('data-type');
        const fieldName = this.getAttribute('data-field-name');

        // Copy to clipboard
        navigator.clipboard.writeText(textToCopy).then(function() {
          // Set custom toast message based on type
          let message = '‚úì Copied to clipboard!';
          if (copyType === 'username') {
            message = '‚úì Username copied!';
          } else if (copyType === 'password') {
            message = '‚úì Password copied!';
          } else if (copyType === 'field' && fieldName) {
            message = `‚úì ${fieldName} copied!`;
          }

          toast.textContent = message;
          toast.classList.add('show');

          // Hide toast after 2 seconds
          setTimeout(function() {
            toast.classList.remove('show');
          }, 2000);
        }).catch(function(err) {
          console.error('Failed to copy:', err);
          toast.textContent = '‚úó Failed to copy';
          toast.classList.add('show');
          setTimeout(function() {
            toast.classList.remove('show');
          }, 2000);
        });
      });
    });

    // Delete functionality
    const deleteButtons = document.querySelectorAll('.delete-btn');
    const modal = document.getElementById('deleteModal');
    const confirmDeleteBtn = document.getElementById('confirmDelete');
    const cancelDeleteBtn = document.getElementById('cancelDelete');
    const deleteMessage = document.getElementById('deleteMessage');
    let entryToDelete = null;

    deleteButtons.forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        entryToDelete = this.getAttribute('data-entry-id');
        const siteName = this.getAttribute('data-site');
        deleteMessage.textContent = `Are you sure you want to delete the password for ${siteName}?`;
        modal.style.display = 'flex';

        // Set up single delete handler
        confirmDeleteBtn.onclick = function() {
          if (entryToDelete) {
            window.location.href = `/delete/${entryToDelete}`;
          }
        };
      });
    });

    cancelDeleteBtn.addEventListener('click', function() {
      modal.style.display = 'none';
      entryToDelete = null;
    });

    window.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
        entryToDelete = null;
      }
    });

    // Bulk Operations
    const selectAllCheckbox = document.getElementById('selectAll');
    const rowCheckboxes = document.querySelectorAll('.row-checkbox');
    const bulkActionsBar = document.getElementById('bulkActionsBar');
    const selectedCountSpan = document.getElementById('selectedCount');
    const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
    const deselectAllBtn = document.getElementById('deselectAllBtn');

    function updateBulkActionsBar() {
      const selectedCheckboxes = document.querySelectorAll('.row-checkbox:checked');
      const count = selectedCheckboxes.length;

      if (count > 0) {
        bulkActionsBar.style.display = 'block';
        selectedCountSpan.textContent = `${count} selected`;
      } else {
        bulkActionsBar.style.display = 'none';
      }

      // Update select all checkbox state
      if (count === rowCheckboxes.length) {
        selectAllCheckbox.checked = true;
        selectAllCheckbox.indeterminate = false;
      } else if (count > 0) {
        selectAllCheckbox.checked = false;
        selectAllCheckbox.indeterminate = true;
      } else {
        selectAllCheckbox.checked = false;
        selectAllCheckbox.indeterminate = false;
      }
    }

    // Select All checkbox
    selectAllCheckbox.addEventListener('change', function() {
      rowCheckboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
      });
      updateBulkActionsBar();
    });

    // Individual checkboxes
    rowCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', updateBulkActionsBar);
    });

    // Deselect All button
    deselectAllBtn.addEventListener('click', function() {
      rowCheckboxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      updateBulkActionsBar();
    });

    // Bulk Delete button
    bulkDeleteBtn.addEventListener('click', function() {
      const selectedCheckboxes = document.querySelectorAll('.row-checkbox:checked');
      const count = selectedCheckboxes.length;

      if (count === 0) return;

      const sites = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-site'));
      const idsToDelete = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-entry-id'));

      // Show modal with message
      if (count === 1) {
        deleteMessage.textContent = `Are you sure you want to delete the password for ${sites[0]}?`;
      } else {
        deleteMessage.textContent = `Are you sure you want to delete ${count} passwords?\n\n${sites.join(', ')}`;
      }

      modal.style.display = 'flex';

      // Override the confirm button to handle bulk delete
      confirmDeleteBtn.onclick = function() {
        // Create form to submit deletions
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("bulk_delete") }}';

        // Add CSRF token
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrf_token';
        csrfInput.value = '{{ csrf_token() }}';
        form.appendChild(csrfInput);

        // Add IDs to delete
        const idsInput = document.createElement('input');
        idsInput.type = 'hidden';
        idsInput.name = 'entry_ids';
        idsInput.value = JSON.stringify(idsToDelete);
        form.appendChild(idsInput);

        document.body.appendChild(form);
        form.submit();
      };
    });

    // Search/Filter functionality
    const searchInput = document.getElementById('searchInput');
    const searchCount = document.getElementById('searchCount');
    const clearSearchBtn = document.getElementById('clearSearch');
    const tableRows = document.querySelectorAll('tbody tr');
    const totalRows = tableRows.length;

    function updateSearchCount() {
      const visibleRows = Array.from(tableRows).filter(row => row.style.display !== 'none').length;
      if (searchInput.value.trim()) {
        searchCount.textContent = `${visibleRows} of ${totalRows}`;
        clearSearchBtn.style.display = 'block';
      } else {
        searchCount.textContent = '';
        clearSearchBtn.style.display = 'none';
      }
    }

    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase().trim();

      tableRows.forEach(function(row) {
        const site = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
        const username = row.querySelector('td:nth-child(3)').textContent.toLowerCase();

        if (site.includes(searchTerm) || username.includes(searchTerm)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });

      updateSearchCount();
    });

    clearSearchBtn.addEventListener('click', function() {
      searchInput.value = '';
      tableRows.forEach(function(row) {
        row.style.display = '';
      });
      updateSearchCount();
      searchInput.focus();
    });

    // Initial count
    updateSearchCount();

    // Export dropdown toggle
    const exportBtn = document.getElementById('exportBtn');
    const exportDropdown = document.getElementById('exportDropdown');

    if (exportBtn && exportDropdown) {
      exportBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        exportDropdown.style.display = exportDropdown.style.display === 'none' ? 'block' : 'none';
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!exportBtn.contains(e.target) && !exportDropdown.contains(e.target)) {
          exportDropdown.style.display = 'none';
        }
      });

      // Hover effects for dropdown items
      const dropdownLinks = exportDropdown.querySelectorAll('a');
      dropdownLinks.forEach(link => {
        link.addEventListener('mouseenter', function() {
          this.style.background = '#f9fafb';
        });
        link.addEventListener('mouseleave', function() {
          this.style.background = 'white';
        });
      });
    }
  });
</script>

<style>
  /* Username copy button hover effect */
  td .copy-btn:hover {
    background: rgba(102, 126, 234, 0.1) !important;
  }

  td .copy-btn:active {
    transform: scale(0.95);
  }
</style>

{% endblock %}