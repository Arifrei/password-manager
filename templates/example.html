{% extends 'base.html' %}

{% block content %}
<h2>Example Page - Demo Passwords</h2>

<div class="table-container">
  <table class="table">
    <thead>
      <tr>
        <th>Site</th>
        <th>Username</th>
        <th>Password</th>
        <th>Show</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for entry, password in data %}
      <tr>
        <td><strong>{{ entry.site }}</strong></td>
        <td>{{ entry.username }}</td>
        <td>
          <input type="password" class="form-control password-field" value="{{ password }}" readonly>
        </td>
        <td>
          <button type="button" class="btn btn-sm btn-outline-secondary toggle-btn">üëÅ</button>
        </td>
        <td>
          <a href="#" class="delete-btn" data-entry-id="{{ entry.id }}" data-site="{{ entry.site }}">üóëÔ∏è Delete</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div style="text-align: center; margin-top: 2rem;">
  <p style="color: var(--text-light); margin-bottom: 1rem;">This is example data to demonstrate the password manager. Deletions are temporary (session only).</p>
  <a href="{{ url_for('register') }}" class="btn btn-primary">Create Your Account</a>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h3>Delete Password (Demo)</h3>
    <p id="deleteMessage">Are you sure you want to delete this password?</p>
    <p style="font-size: 0.85rem; color: var(--text-light);">This will only delete it for your current session.</p>
    <div class="modal-buttons">
      <button id="cancelDelete" class="btn btn-outline-secondary">Cancel</button>
      <button id="confirmDelete" class="btn btn-danger">Delete</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleButtons = document.querySelectorAll('.toggle-btn');

    toggleButtons.forEach(function (btn) {
      btn.addEventListener('click', function () {
        const passwordInput = this.closest('tr').querySelector('.password-field');
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          this.textContent = 'üôà';
        } else {
          passwordInput.type = 'password';
          this.textContent = 'üëÅ';
        }
      });
    });

    // Delete confirmation modal
    const modal = document.getElementById('deleteModal');
    const deleteMessage = document.getElementById('deleteMessage');
    const confirmBtn = document.getElementById('confirmDelete');
    const cancelBtn = document.getElementById('cancelDelete');
    let deleteUrl = '';

    document.querySelectorAll('.delete-btn').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const entryId = this.getAttribute('data-entry-id');
        const site = this.getAttribute('data-site');
        deleteUrl = "{{ url_for('delete_example', entry_id=0) }}".replace('0', entryId);
        deleteMessage.textContent = `Are you sure you want to delete the password for ${site}?`;
        modal.style.display = 'flex';
      });
    });

    confirmBtn.addEventListener('click', function() {
      window.location.href = deleteUrl;
    });

    cancelBtn.addEventListener('click', function() {
      modal.style.display = 'none';
    });

    // Close modal when clicking outside
    window.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
</script>
{% endblock %}